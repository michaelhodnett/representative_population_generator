
### Table of Contents
<!-- Table of contents generated generated by http://tableofcontent.eu -->
- [Model Selection and Validation](#model-selection-and-validation)
  - [Problem Statement](#problem-statement)
  - [Facility Location Problems](#facility-location-problems)
  - [Farthest-First Traversal Algorithm](#farthest-first-traversal-algorithm)
  - [Next Steps](#next-steps)
- [Data Sources](#data-sources)
  - [Access](#access)
  - [Advantages](#advantages)
    - [1. Explicitly accessible by ZIP](#1-explicitly-accessible-by-zip)
    - [2. Reliability](#2-reliability)
    - [3. Has population estimates](#3-has-population-estimates)
  - [Limitations](#limitations)
    - [1. Missing ZIP codes](#1-missing-zip-codes)
    - [2. ZIP codes with one point](#2-zip-codes-with-one-point)
    - [3. Lack of census information](#3-lack-of-census-information)

## Model Selection and Validation

### Problem Statement

The purpose of the representative population points generator is to assist in measuring the adequacy of health insurance networks. If a remote cluster of points has no representative point among them, the ensuing network adequacy analysis will utterly overlook the people who live there. Accordingly, good algorithms for this particular use case should ensure that _all_ points are near to at least one representative point.

**Caveat**: the _Garbage In, Garbage Out_ principle applies here. If the input data does not accurately reflect where people actually live and work, then any points selected by an algorithm won’t either. For the purposes of this document, we assume that the input is valid and concern ourselves only with the problem of selecting representative points from trustworthy data. See [this section](#data-sources) for an explanation of the data sources underlying the application.

### Facility Location Problems

We can consider this problem as belonging to a class of facility location problems, where the goal is to choose the optimal placements of facilities to minimize a certain objective function (for example, transportation costs). See [this paper](http://www.sciencedirect.com/science/article/pii/S0305054816301253?via%3Dihub) for an overview of facility location problems in the field of healthcare.

Specifically, consider the _Metric k-center Problem_: Given _n_ cities with specified locations, build warehouses in _k_ different cities to minimize the maximum distance of a city to the nearest warehouse.

This problem comes with its own built-in validation metric, _viz._ the largest distance between a city and the nearest city with a warehouse.

Intuitively, we want every input population point (city in the analogy) in a service area to have at least one selected representative population point (warehouse) nearby. If after applying the algorithm even a single input population point does not have a selected point nearby, the maximum distance between the input and the selected points will still be high. This facet of the problem means that solutions must explicitly prioritize remote points, an appropriate feature given the ultimate use of the selected points in measuring network adequacy.

On the other hand, if the maximum distance between the input and selected points is some small value _d_, we have guaranteed that distances that replace the input point with the selected one will have an error bounded by _d_.
Taken together, these features entail that solutions to this more specific problem make for reasonable solutions to the broader one.

### Farthest-First Traversal Algorithm
The metric k-center problem is NP-hard. The literature contains several polynomial-time approximations to make the computation more tractable. For an analysis of the problem's complexity and an overview of optimal algorithms, see [[1]](https://ac.els-cdn.com/0304397585902245/1-s2.0-0304397585902245-main.pdf?_tid=6c644f16-a72f-11e7-b1e9-00000aacb361&acdnat=1506920958_ef265d284be26c85f897df3ebcee3d74), [[2]](https://pdfs.semanticscholar.org/f276/c00bac7594107c291947f560b7b48b1439d7.pdf), and [[3]](http://theory.stanford.edu/~tomas/clustering.ps).

One straightforward such approximation employs _farthest-first traversal_. At each stage, this algorithm finds the point that is farthest away from the currently selected points and chooses it as the next point. Essentially the algorithm looks to see what point is the most problematic (in terms of the objective function) and eliminates the problem: By selecting the farthest point next, its distance from the selected points drops to 0. The algorithm greedily puts out the biggest fire at each successive step.

This solution has an approximation factor of 2, ensuring that the objective function is at worst two times the smallest value that could be achieved considering any possible subset of size k from the original input. The algorithm has a runtime of _O(kn)_.

A further advantage of this algorithm is the sequential selection of points: once some number _K_ of representative points are chosen, each initial segment of size _k_ for _k < K_ can be taken as a selection of _k_ representative population points. This means that a single calculation with a high value of _K_ is sufficient to provide users with sets of representative population points of all smaller sizes.

The implementation allows users to specify alternative stopping rules based on the value of the objective function. Given a fixed distance (in miles), once all input points are within this distance of their nearest selected point, the model will stop selecting new points. This feature allows the model to select only a few representative population points in the situation when selecting additional points has diminishing returns. This is especially valuable for the performance of downstream applications, as points will not be needlessly generated in regions of high density.

The implementation selects the first point as the nearest input point to the population-weighted center of mass. This ensures that the algorithm is fully deterministic, in contrast to other implementations using a random initial point. This feature is especially helpful when the number of points for the region is small; e.g., when using a relatively large distance cutoff as described above.

For an illustration of the algorithm applied to the application's underlying data, see [this IPython notebook](./data_analysis/notebooks/Farthest%20First%20Traversal.ipynb).

### Next Steps

__Apply Methods from Supervised Learning__. We can treat the problem of representative population points as a supervised problem and use standard cross-validation techniques to evaluate the algorithm's expected performance on unseen data. This would help to account for the uncertainty inherent in the source data.

__Account for Population Density__. The current algorithm doesn't take population information into account when selected the next point, but such information is present in the source data. A weighted version of the algorithm could more accurately reflect where people live _on average_. Care must be taken to ensure that the modified algorithm does not systematically ignore points in regions of low population density.

## Data Sources

We use US Postal Service [Every Door Direct Mail](https://www.usps.com/business/every-door-direct-mail.htm) (EDDM) data as our source for identifying residential and commercial addresses as a basis for our calculation of representative population points.

### Access

The EDDM data can be accessed via ArcGIS REST API. For an example, see this webpage: [https://gis.usps.com/arcgis/rest/services/EDDM/selectZIP/GPServer/routes/execute?f=json&env%3AoutSR=102100&ZIP=94601&Rte_Box=R&UserName=EDDM](https://gis.usps.com/arcgis/rest/services/EDDM/selectZIP/GPServer/routes/execute?f=json&env%3AoutSR=102100&ZIP=94601&Rte_Box=R&UserName=EDDM)

The data can be retrieved one ZIP code at a time. Since the ArcGIS script is called "selectZIP," it seems unlikely that bulk access is possible through online means. We have initiated a FOIA request for the data; we expect response of USPS to provide valuable information (how they generate the data, what the terms of use are, &c).

### Advantages

In addition to the requirements above, this data source has the following advantages:

#### 1. Explicitly accessible by ZIP

Unlike census data, the EDDM data comes with points assigned to ZIP codes. Because ZIPs are explicitly not defined as polygons, we believe it is easier to move in this direction (ZIP → census) than vice versa. Because the source is USPS, we expect this information to be accurate and up-to-date.

#### 2. Reliability

Unlike other open source address data (e.g., Openaddresses.io, OpenStreetMap, DoT National Address Database), the EDDM data appears to closely correspond to the truth "on the ground." When the EDDM tool has a point, there typically is a building there (as validated by satellite imagery).

#### 3. Has population estimates

The USPS has implemented a crosswalk with census data to obtain these estimates. Using this data source obviates the need to reinvent the wheel and perform the crosswalk manually.

### Limitations

No data source is perfect. The following are some potential concerns with the using data scraped from the EDDM tool.

#### 1. Missing ZIP codes

Not every ZIP code is present in the EDDM tool. For example, zip code 92055 corresponds to Camp Pendleton, a Marine Corps base. It makes sense that the USPS would not allow for commercial mailers to target this ZIP for advertising campaigns.

There are ZIP codes found in other sources such as Google Maps that are missing from the EDDM tool entirely. Examples include 94615, 94617, 94622, 94649, 94659. These could be deprecated ZIPs no longer in use, or PO boxes for which EDDM is unavailable for whatever reason (similar to Camp Pendleton).

#### 2. ZIP codes with one point

In certain rural ZIPs, every resident gets their mail at the nearest post office: There are no mailing routes. This means that the EDDM tool will have only a single point (corresponding to the PO Box) for the entire ZIP. Examples include 95915, 93627, 95426, 96006, 95701.

These ZIPs can cover large areas, so representing them with a single point is problematic when performing adequacy calculations.

#### 3. Lack of census information

Because the points come from USPS, they do not come tagged with relevant census-type information (e.g., county, census block, etc.). Such information has to be determined by intersecting geometries.
